/**
 * Cliente API para comunicarse con las rutas API de Next.js
 * Las rutas API actúan como proxy y manejan la autenticación y API key server-side
 */

const API_BASE_URL = '/api/permit';

class ApiError extends Error {
  constructor(
    message: string,
    public status: number,
    public data?: any
  ) {
    super(message);
    this.name = 'ApiError';
  }
}

async function fetchApi<T>(
  endpoint: string,
  options?: RequestInit
): Promise<T> {
  const url = `${API_BASE_URL}${endpoint}`;
  
  const response = await fetch(url, {
    ...options,
    headers: {
      'Content-Type': 'application/json',
      ...options?.headers,
    },
  });

  if (!response.ok) {
    const errorData = await response.json().catch(() => ({}));
    throw new ApiError(
      errorData.message || `HTTP error! status: ${response.status}`,
      response.status,
      errorData
    );
  }

  return response.json();
}

// ==================== USUARIOS ====================

export interface User {
  id: number;
  name: string;
  email: string;
  createdAt: string | Date;
}

export interface CreateUserInput {
  name: string;
  email: string;
}

export interface UpdateUserInput {
  name?: string;
  email?: string;
}

export const usersApi = {
  getAll: async (): Promise<User[]> => {
    return fetchApi<User[]>('/users/');
  },

  getById: async (id: number): Promise<User> => {
    return fetchApi<User>(`/users/${id}`);
  },

  create: async (data: CreateUserInput): Promise<User> => {
    return fetchApi<User>('/users/', {
      method: 'POST',
      body: JSON.stringify(data),
    });
  },

  update: async (id: number, data: UpdateUserInput): Promise<User> => {
    return fetchApi<User>(`/users/${id}`, {
      method: 'PUT',
      body: JSON.stringify(data),
    });
  },

  delete: async (id: number): Promise<{ message: string; user: User }> => {
    return fetchApi<{ message: string; user: User }>(`/users/${id}`, {
      method: 'DELETE',
    });
  },

  signIn: async (email: string, password: string): Promise<{
    token: string;
    user: Omit<User, 'createdAt'>;
  }> => {
    return fetchApi<{ token: string; user: Omit<User, 'createdAt'> }>(
      '/users/sign-in',
      {
        method: 'POST',
        body: JSON.stringify({ email, password }),
      }
    );
  },
};

// ==================== PRODUCTOS ====================

export interface Role {
  id: number;
  name: string;
  description: string | null;
  createdAt: string | Date;
  updatedAt: string | Date;
}

export interface CreateRoleInput {
  name: string;
  description?: string;
}

export interface UpdateRoleInput {
  name?: string;
  description?: string;
}

export const rolesApi = {
  getAll: async (): Promise<Role[]> => {
    return fetchApi<Role[]>('/roles/');
  },

  getById: async (id: number): Promise<Role> => {
    return fetchApi<Role>(`/roles/${id}`);
  },

  create: async (data: CreateRoleInput): Promise<Role> => {
    return fetchApi<Role>('/roles/', {
      method: 'POST',
      body: JSON.stringify(data),
    });
  },

  update: async (id: number, data: UpdateRoleInput): Promise<Role> => {
    return fetchApi<Role>(`/roles/${id}`, {
      method: 'PUT',
      body: JSON.stringify(data),
    });
  },

  delete: async (id: number): Promise<{ message: string; role: Role }> => {
    return fetchApi<{ message: string; role: Role }>(`/roles/${id}`, {
      method: 'DELETE',
    });
  },
};

// ==================== RECURSOS ====================

export interface Resource {
  id: number;
  name: string;
  description: string | null;
  createdAt: string | Date;
  updatedAt: string | Date;
}

export interface CreateResourceInput {
  name: string;
  description?: string;
}

export interface UpdateResourceInput {
  name?: string;
  description?: string;
}

export const resourcesApi = {
  getAll: async (): Promise<Resource[]> => {
    return fetchApi<Resource[]>('/resources/');
  },

  getById: async (id: number): Promise<Resource> => {
    return fetchApi<Resource>(`/resources/${id}`);
  },

  create: async (data: CreateResourceInput): Promise<Resource> => {
    return fetchApi<Resource>('/resources/', {
      method: 'POST',
      body: JSON.stringify(data),
    });
  },

  update: async (id: number, data: UpdateResourceInput): Promise<Resource> => {
    return fetchApi<Resource>(`/resources/${id}`, {
      method: 'PUT',
      body: JSON.stringify(data),
    });
  },

  delete: async (
    id: number
  ): Promise<{ message: string; resource: Resource }> => {
    return fetchApi<{ message: string; resource: Resource }>(
      `/resources/${id}`,
      {
        method: 'DELETE',
      }
    );
  },
};

// ==================== PERMISOS ====================

export interface Permission {
  id: number;
  name: string;
  action: string;
  resourceId: number;
  resourceName: string | null;
  description: string | null;
  createdAt: string | Date;
  updatedAt: string | Date;
}

export interface CreatePermissionInput {
  name: string;
  action: string;
  resourceId: number;
  description?: string;
}

export interface UpdatePermissionInput {
  name?: string;
  action?: string;
  resourceId?: number;
  description?: string;
}

export const permissionsApi = {
  getAll: async (): Promise<Permission[]> => {
    return fetchApi<Permission[]>('/permissions/');
  },

  getById: async (id: number): Promise<Permission> => {
    return fetchApi<Permission>(`/permissions/${id}`);
  },

  getByResource: async (resourceId: number): Promise<Permission[]> => {
    return fetchApi<Permission[]>(`/permissions/resource/${resourceId}`);
  },

  create: async (data: CreatePermissionInput): Promise<Permission> => {
    return fetchApi<Permission>('/permissions/', {
      method: 'POST',
      body: JSON.stringify(data),
    });
  },

  update: async (
    id: number,
    data: UpdatePermissionInput
  ): Promise<Permission> => {
    return fetchApi<Permission>(`/permissions/${id}`, {
      method: 'PUT',
      body: JSON.stringify(data),
    });
  },

  delete: async (
    id: number
  ): Promise<{ message: string; permission: Permission }> => {
    return fetchApi<{ message: string; permission: Permission }>(
      `/permissions/${id}`,
      {
        method: 'DELETE',
      }
    );
  },
};

// ==================== ROLE-PERMISSIONS ====================

export interface RolePermission {
  id: number;
  roleId: number;
  permissionId: number;
  permissionName?: string | null;
  permissionAction?: string | null;
  resourceId?: number | null;
  resourceName?: string | null;
  createdAt: string | Date;
}

export interface CreateRolePermissionInput {
  roleId: number;
  permissionId: number;
}

export const rolePermissionsApi = {
  assign: async (
    data: CreateRolePermissionInput
  ): Promise<{ message: string; assignment: RolePermission }> => {
    return fetchApi<{ message: string; assignment: RolePermission }>(
      '/role-permissions/',
      {
        method: 'POST',
        body: JSON.stringify(data),
      }
    );
  },

  remove: async (
    roleId: number,
    permissionId: number
  ): Promise<{ message: string; assignment: RolePermission }> => {
    return fetchApi<{ message: string; assignment: RolePermission }>(
      `/role-permissions/${roleId}/${permissionId}`,
      {
        method: 'DELETE',
      }
    );
  },

  getByRole: async (roleId: number): Promise<RolePermission[]> => {
    return fetchApi<RolePermission[]>(`/role-permissions/role/${roleId}`);
  },

  getByPermission: async (permissionId: number): Promise<RolePermission[]> => {
    return fetchApi<RolePermission[]>(
      `/role-permissions/permission/${permissionId}`
    );
  },
};

// ==================== USER-ROLES ====================

export interface UserRole {
  id: number;
  userId: number;
  roleId: number;
  roleName?: string | null;
  roleDescription?: string | null;
  userName?: string | null;
  userEmail?: string | null;
  createdAt: string | Date;
}

export interface UserPermission {
  permissionId: number;
  permissionName: string | null;
  permissionAction: string | null;
  resourceId: number | null;
  resourceName: string | null;
  roleId: number;
  roleName: string | null;
}

export interface CreateUserRoleInput {
  userId: number;
  roleId: number;
}

// ==================== AVAILABLE ====================

export interface AvailableResources {
  resources: Array<{
    id: number;
    name: string;
    description: string | null;
  }>;
  actions: string[];
}

export const availableApi = {
  getAvailable: async (): Promise<AvailableResources> => {
    return fetchApi<AvailableResources>('/available');
  },
};

// ==================== TIPOS DE AUSENCIA ====================

export interface LeaveType {
  id: number;
  name: string;
  code: string;
  maxDaysPerYear?: number | null;
  carryOverAllowed?: boolean | null;
  requiresApproval?: boolean | null;
  color?: string | null;
}

export interface CreateLeaveTypeInput {
  name: string;
  code: string;
  maxDaysPerYear?: number;
  carryOverAllowed?: boolean;
  requiresApproval?: boolean;
  color?: string;
}

export interface UpdateLeaveTypeInput {
  name?: string;
  code?: string;
  maxDaysPerYear?: number;
  carryOverAllowed?: boolean;
  requiresApproval?: boolean;
  color?: string;
}

export const leaveTypesApi = {
  getAll: async (): Promise<LeaveType[]> => {
    return fetchApi<LeaveType[]>('/leave-types');
  },
  getById: async (id: number): Promise<LeaveType> => {
    return fetchApi<LeaveType>(`/leave-types/${id}`);
  },
  create: async (data: CreateLeaveTypeInput): Promise<LeaveType> => {
    return fetchApi<LeaveType>('/leave-types', {
      method: 'POST',
      body: JSON.stringify(data),
    });
  },
  update: async (id: number, data: UpdateLeaveTypeInput): Promise<LeaveType> => {
    return fetchApi<LeaveType>(`/leave-types/${id}`, {
      method: 'PUT',
      body: JSON.stringify(data),
    });
  },
  delete: async (id: number): Promise<{ message: string; leaveType: LeaveType }> => {
    return fetchApi<{ message: string; leaveType: LeaveType }>(`/leave-types/${id}`, {
      method: 'DELETE',
    });
  },
};

// ==================== SOLICITUDES DE AUSENCIA ====================

export interface LeaveRequest {
  id: number;
  userId: number;
  leaveTypeId: number;
  startDate: string;
  endDate: string;
  daysCount: number;
  reason?: string | null;
  status: string; // pending, approved, rejected
  approvedBy?: number | null;
  approvedAt?: string | null;
  rejectionReason?: string | null;
  createdAt: string;
  updatedAt: string;
}

export interface CreateLeaveRequestInput {
  userId: number;
  leaveTypeId: number;
  startDate: string;
  endDate: string;
  reason?: string;
}

export interface ApproveLeaveRequestInput {
  approvedBy: number;
}

export interface RejectLeaveRequestInput {
  approvedBy: number;
  rejectionReason: string;
}

export const leaveRequestsApi = {
  getAll: async (filters?: { userId?: number; status?: string; startDate?: string; endDate?: string }): Promise<LeaveRequest[]> => {
    const params = new URLSearchParams();
    if (filters?.userId) params.set('user_id', filters.userId.toString());
    if (filters?.status) params.set('status', filters.status);
    if (filters?.startDate) params.set('start_date', filters.startDate);
    if (filters?.endDate) params.set('end_date', filters.endDate);
    const query = params.toString();
    return fetchApi<LeaveRequest[]>(`/leave-requests${query ? '?' + query : ''}`);
  },
  getById: async (id: number): Promise<LeaveRequest> => {
    return fetchApi<LeaveRequest>(`/leave-requests/${id}`);
  },
  create: async (data: CreateLeaveRequestInput): Promise<LeaveRequest> => {
    return fetchApi<LeaveRequest>('/leave-requests', {
      method: 'POST',
      body: JSON.stringify(data),
    });
  },
  approve: async (id: number, data: ApproveLeaveRequestInput): Promise<LeaveRequest> => {
    return fetchApi<LeaveRequest>(`/leave-requests/${id}/approve`, {
      method: 'PUT',
      body: JSON.stringify(data),
    });
  },
  reject: async (id: number, data: RejectLeaveRequestInput): Promise<LeaveRequest> => {
    return fetchApi<LeaveRequest>(`/leave-requests/${id}/reject`, {
      method: 'PUT',
      body: JSON.stringify(data),
    });
  },
};

// ==================== USER ROLES ====================

// ==================== ORGANIGRAMA ====================

export interface OrgChartNode {
  id: number;
  name: string;
  email: string;
  employeeId?: string | null;
  positionId?: number | null;
  departmentId?: number | null;
  managerId?: number | null;
  subordinates: OrgChartNode[];
}

export const orgChartApi = {
  getFull: async (): Promise<OrgChartNode[]> => {
    return fetchApi<OrgChartNode[]>('/org-chart');
  },
  getFromUser: async (userId: number): Promise<{ user: User; subordinates: OrgChartNode[] }> => {
    return fetchApi<{ user: User; subordinates: OrgChartNode[] }>(`/org-chart?userId=${userId}`);
  },
};

export const userRolesApi = {
  assign: async (
    data: CreateUserRoleInput
  ): Promise<{ message: string; assignment: UserRole }> => {
    return fetchApi<{ message: string; assignment: UserRole }>(
      '/user-roles/',
      {
        method: 'POST',
        body: JSON.stringify(data),
      }
    );
  },

  remove: async (
    userId: number,
    roleId: number
  ): Promise<{ message: string; assignment: UserRole }> => {
    return fetchApi<{ message: string; assignment: UserRole }>(
      `/user-roles/${userId}/${roleId}`,
      {
        method: 'DELETE',
      }
    );
  },

  getByUser: async (userId: number): Promise<UserRole[]> => {
    return fetchApi<UserRole[]>(`/user-roles/user/${userId}`);
  },

  getUserPermissions: async (userId: number): Promise<UserPermission[]> => {
    return fetchApi<UserPermission[]>(
      `/user-roles/user/${userId}/permissions`
    );
  },

  getByRole: async (roleId: number): Promise<UserRole[]> => {
    return fetchApi<UserRole[]>(`/user-roles/role/${roleId}`);
  },
};

// ==================== PERFORMANCE - INDICATORS ====================

export interface PerformanceIndicator {
  id: number;
  name: string;
  description?: string | null;
  type: 'numeric' | 'percentage' | 'boolean' | 'text';
  unit?: string | null;
  targetValue?: number | null;
  weight?: number | null;
  category?: string | null;
  isActive: boolean;
  createdAt: string | Date;
  updatedAt: string | Date;
}

export interface CreateIndicatorInput {
  name: string;
  description?: string;
  type: 'numeric' | 'percentage' | 'boolean' | 'text';
  unit?: string;
  targetValue?: number;
  weight?: number;
  category?: string;
  isActive?: boolean;
}

export interface UpdateIndicatorInput {
  name?: string;
  description?: string;
  type?: 'numeric' | 'percentage' | 'boolean' | 'text';
  unit?: string;
  targetValue?: number;
  weight?: number;
  category?: string;
  isActive?: boolean;
}

export const indicatorsApi = {
  getAll: async (activeOnly?: boolean): Promise<PerformanceIndicator[]> => {
    const url = activeOnly 
      ? '/v1/performance/indicators?activeOnly=true'
      : '/v1/performance/indicators';
    return fetchApi<PerformanceIndicator[]>(url);
  },
  getById: async (id: number): Promise<PerformanceIndicator> => {
    return fetchApi<PerformanceIndicator>(`/v1/performance/indicators/${id}`);
  },
  create: async (data: CreateIndicatorInput): Promise<PerformanceIndicator> => {
    return fetchApi<PerformanceIndicator>('/v1/performance/indicators', {
      method: 'POST',
      body: JSON.stringify(data),
    });
  },
  update: async (id: number, data: UpdateIndicatorInput): Promise<PerformanceIndicator> => {
    return fetchApi<PerformanceIndicator>(`/v1/performance/indicators/${id}`, {
      method: 'PUT',
      body: JSON.stringify(data),
    });
  },
  delete: async (id: number): Promise<{ message: string }> => {
    return fetchApi<{ message: string }>(`/v1/performance/indicators/${id}`, {
      method: 'DELETE',
    });
  },
};

// ==================== PERFORMANCE - EVALUATIONS ====================

export interface EvaluationScore {
  id: number;
  evaluationId: number;
  indicatorId: number;
  value: number;
  targetValue?: number | null;
  achievementPercentage?: number | null;
  notes?: string | null;
}

export interface Evaluation {
  id: number;
  userId: number;
  evaluatorId: number;
  periodType: 'monthly' | 'quarterly' | 'annual';
  periodStart: string;
  periodEnd: string;
  status: 'draft' | 'submitted' | 'reviewed' | 'finalized';
  overallScore?: number | null;
  comments?: string | null;
  createdAt: string | Date;
  updatedAt: string | Date;
  scores?: EvaluationScore[];
}

export interface CreateEvaluationInput {
  userId: number;
  evaluatorId: number;
  periodType: 'monthly' | 'quarterly' | 'annual';
  periodStart: string;
  periodEnd: string;
  comments?: string;
  scores?: Array<{
    indicatorId: number;
    value: number;
    targetValue?: number;
    notes?: string;
  }>;
}

export interface UpdateEvaluationInput {
  status?: 'draft' | 'submitted' | 'reviewed' | 'finalized';
  overallScore?: number;
  comments?: string;
  scores?: Array<{
    indicatorId: number;
    value: number;
    targetValue?: number;
    notes?: string;
  }>;
}

export interface PerformanceSummary {
  userId: number;
  periodType?: string;
  averageScore: number;
  totalEvaluations: number;
  evaluations: Evaluation[];
  trends: Array<{
    period: string;
    score: number;
  }>;
}

export const evaluationsApi = {
  getAll: async (filters?: {
    userId?: number;
    evaluatorId?: number;
    status?: string;
    periodType?: string;
  }): Promise<Evaluation[]> => {
    const params = new URLSearchParams();
    if (filters?.userId) params.set('userId', filters.userId.toString());
    if (filters?.evaluatorId) params.set('evaluatorId', filters.evaluatorId.toString());
    if (filters?.status) params.set('status', filters.status);
    if (filters?.periodType) params.set('periodType', filters.periodType);
    
    const query = params.toString();
    return fetchApi<Evaluation[]>(`/v1/performance/evaluations${query ? `?${query}` : ''}`);
  },
  getById: async (id: number): Promise<Evaluation> => {
    return fetchApi<Evaluation>(`/v1/performance/evaluations/${id}`);
  },
  create: async (data: CreateEvaluationInput): Promise<Evaluation> => {
    return fetchApi<Evaluation>('/v1/performance/evaluations', {
      method: 'POST',
      body: JSON.stringify(data),
    });
  },
  update: async (id: number, data: UpdateEvaluationInput): Promise<Evaluation> => {
    return fetchApi<Evaluation>(`/v1/performance/evaluations/${id}`, {
      method: 'PUT',
      body: JSON.stringify(data),
    });
  },
  submit: async (id: number): Promise<Evaluation> => {
    return fetchApi<Evaluation>(`/v1/performance/evaluations/${id}/submit`, {
      method: 'POST',
    });
  },
  finalize: async (id: number): Promise<Evaluation> => {
    return fetchApi<Evaluation>(`/v1/performance/evaluations/${id}/finalize`, {
      method: 'POST',
    });
  },
  getUserSummary: async (userId: number, periodType?: string): Promise<PerformanceSummary> => {
    const url = periodType
      ? `/v1/performance/evaluations/user/${userId}/summary?periodType=${periodType}`
      : `/v1/performance/evaluations/user/${userId}/summary`;
    return fetchApi<PerformanceSummary>(url);
  },
};

// ==================== NOTIFICACIONES ====================

export interface Notification {
  id: number;
  userId: number;
  type: string;
  title: string;
  message: string;
  data?: any;
  readAt?: string | Date | null;
  actionUrl?: string | null;
  createdAt: string | Date;
}

export interface NotificationPreference {
  id: number;
  userId: number;
  channel: 'email' | 'in-app' | 'push';
  notificationType: string;
  enabled: boolean;
  createdAt: string | Date;
  updatedAt: string | Date;
}

export interface UpdateNotificationPreferenceInput {
  channel: 'email' | 'in-app' | 'push';
  notificationType: string;
  enabled: boolean;
}

export const notificationsApi = {
  getAll: async (userId: number, filters?: { unreadOnly?: boolean; limit?: number }): Promise<Notification[]> => {
    const params = new URLSearchParams();
    params.set('userId', userId.toString());
    if (filters?.unreadOnly) params.set('unreadOnly', 'true');
    if (filters?.limit) params.set('limit', filters.limit.toString());
    return fetchApi<Notification[]>(`/v1/notifications?${params.toString()}`);
  },
  getUnreadCount: async (userId: number): Promise<{ count: number }> => {
    return fetchApi<{ count: number }>(`/v1/notifications/unread-count?userId=${userId}`);
  },
  markAsRead: async (id: number, userId: number): Promise<Notification> => {
    return fetchApi<Notification>(`/v1/notifications/${id}/read?userId=${userId}`, {
      method: 'PUT',
    });
  },
  markAllAsRead: async (userId: number): Promise<{ message: string }> => {
    return fetchApi<{ message: string }>(`/v1/notifications/read-all?userId=${userId}`, {
      method: 'PUT',
    });
  },
  getPreferences: async (userId: number): Promise<NotificationPreference[]> => {
    return fetchApi<NotificationPreference[]>(`/v1/notifications/preferences?userId=${userId}`);
  },
  updatePreference: async (userId: number, data: UpdateNotificationPreferenceInput): Promise<NotificationPreference> => {
    return fetchApi<NotificationPreference>(`/v1/notifications/preferences?userId=${userId}`, {
      method: 'PUT',
      body: JSON.stringify(data),
    });
  },
};

// ==================== AUDITORÍA ====================

export interface AuditLog {
  id: number;
  userId?: number | null;
  action: string;
  entityType: string;
  entityId?: number | null;
  changes?: {
    before?: any;
    after?: any;
  } | null;
  ipAddress?: string | null;
  userAgent?: string | null;
  metadata?: any;
  createdAt: string | Date;
}

export interface AuditLogFilters {
  userId?: number;
  action?: string;
  entityType?: string;
  entityId?: number;
  startDate?: string;
  endDate?: string;
  limit?: number;
  offset?: number;
}

export interface AuditLogsResponse {
  logs: AuditLog[];
  pagination: {
    total: number;
    limit: number;
    offset: number;
    hasMore: boolean;
  };
}

export const auditLogsApi = {
  getAll: async (filters?: AuditLogFilters): Promise<AuditLogsResponse> => {
    const params = new URLSearchParams();
    if (filters?.userId) params.set('userId', filters.userId.toString());
    if (filters?.action) params.set('action', filters.action);
    if (filters?.entityType) params.set('entityType', filters.entityType);
    if (filters?.entityId) params.set('entityId', filters.entityId.toString());
    if (filters?.startDate) params.set('startDate', filters.startDate);
    if (filters?.endDate) params.set('endDate', filters.endDate);
    if (filters?.limit) params.set('limit', filters.limit.toString());
    if (filters?.offset) params.set('offset', filters.offset.toString());
    
    const query = params.toString();
    return fetchApi<AuditLogsResponse>(`/v1/audit-logs${query ? `?${query}` : ''}`);
  },
  getByEntity: async (type: string, id: number, limit?: number): Promise<AuditLog[]> => {
    const url = limit
      ? `/v1/audit-logs/entity/${type}/${id}?limit=${limit}`
      : `/v1/audit-logs/entity/${type}/${id}`;
    return fetchApi<AuditLog[]>(url);
  },
  getByUser: async (userId: number, limit?: number): Promise<AuditLog[]> => {
    const url = limit
      ? `/v1/audit-logs/user/${userId}?limit=${limit}`
      : `/v1/audit-logs/user/${userId}`;
    return fetchApi<AuditLog[]>(url);
  },
};

// ==================== PRODUCTOS ====================

export interface Product {
  id: number;
  imageUrl: string;
  name: string;
  status: 'active' | 'inactive' | 'archived';
  price: string;
  stock: number;
  availableAt: string | Date;
}

export interface CreateProductInput {
  imageUrl: string;
  name: string;
  status: 'active' | 'inactive' | 'archived';
  price: string;
  stock: number;
  availableAt: string;
}

export interface UpdateProductInput {
  imageUrl?: string;
  name?: string;
  status?: 'active' | 'inactive' | 'archived';
  price?: string;
  stock?: number;
  availableAt?: string;
}

export interface ProductFilters {
  search?: string;
  status?: 'active' | 'inactive' | 'archived';
  offset?: number;
  limit?: number;
}

export const productsApi = {
  getAll: async (filters?: ProductFilters): Promise<{ products: Product[]; total: number; offset: number | null }> => {
    const params = new URLSearchParams();
    if (filters?.search) params.set('q', filters.search);
    if (filters?.status) params.set('status', filters.status);
    if (filters?.offset) params.set('offset', filters.offset.toString());
    if (filters?.limit) params.set('limit', filters.limit.toString());
    
    const query = params.toString();
    return fetchApi<{ products: Product[]; total: number; offset: number | null }>(`/permit/vendor/products${query ? `?${query}` : ''}`);
  },

  getById: async (id: number): Promise<Product> => {
    return fetchApi<Product>(`/permit/vendor/products/${id}`);
  },

  create: async (data: CreateProductInput): Promise<Product> => {
    return fetchApi<Product>('/permit/vendor/products', {
      method: 'POST',
      body: JSON.stringify(data),
    });
  },

  update: async (id: number, data: UpdateProductInput): Promise<Product> => {
    return fetchApi<Product>(`/permit/vendor/products/${id}`, {
      method: 'PUT',
      body: JSON.stringify(data),
    });
  },

  delete: async (id: number): Promise<{ message: string; product: Product }> => {
    return fetchApi<{ message: string; product: Product }>(`/permit/vendor/products/${id}`, {
      method: 'DELETE',
    });
  },
};

// ==================== CLIENTES ====================

export interface Customer {
  id: number;
  name: string;
  email: string;
  phone?: string | null;
  address?: string | null;
  createdAt: string | Date;
}

export interface CreateCustomerInput {
  name: string;
  email: string;
  phone?: string;
  address?: string;
}

export interface UpdateCustomerInput {
  name?: string;
  email?: string;
  phone?: string;
  address?: string;
}

export const customersApi = {
  getAll: async (): Promise<Customer[]> => {
    return fetchApi<Customer[]>('/permit/vendor/customers');
  },

  getById: async (id: number): Promise<Customer> => {
    return fetchApi<Customer>(`/permit/vendor/customers/${id}`);
  },

  create: async (data: CreateCustomerInput): Promise<Customer> => {
    return fetchApi<Customer>('/permit/vendor/customers', {
      method: 'POST',
      body: JSON.stringify(data),
    });
  },

  update: async (id: number, data: UpdateCustomerInput): Promise<Customer> => {
    return fetchApi<Customer>(`/permit/vendor/customers/${id}`, {
      method: 'PUT',
      body: JSON.stringify(data),
    });
  },

  delete: async (id: number): Promise<{ message: string; customer: Customer }> => {
    return fetchApi<{ message: string; customer: Customer }>(`/permit/vendor/customers/${id}`, {
      method: 'DELETE',
    });
  },
};

// ==================== ÓRDENES ====================

export interface Order {
  id: number;
  customerId: number;
  customerName?: string;
  status: 'pending' | 'processing' | 'shipped' | 'delivered' | 'cancelled';
  total: string;
  createdAt: string | Date;
  updatedAt: string | Date;
}

export interface CreateOrderInput {
  customerId: number;
  status?: 'pending' | 'processing' | 'shipped' | 'delivered' | 'cancelled';
  total: string;
}

export interface UpdateOrderInput {
  customerId?: number;
  status?: 'pending' | 'processing' | 'shipped' | 'delivered' | 'cancelled';
  total?: string;
}

export const ordersApi = {
  getAll: async (): Promise<Order[]> => {
    return fetchApi<Order[]>('/permit/vendor/orders');
  },

  getById: async (id: number): Promise<Order> => {
    return fetchApi<Order>(`/permit/vendor/orders/${id}`);
  },

  create: async (data: CreateOrderInput): Promise<Order> => {
    return fetchApi<Order>('/permit/vendor/orders', {
      method: 'POST',
      body: JSON.stringify(data),
    });
  },

  update: async (id: number, data: UpdateOrderInput): Promise<Order> => {
    return fetchApi<Order>(`/permit/vendor/orders/${id}`, {
      method: 'PUT',
      body: JSON.stringify(data),
    });
  },

  delete: async (id: number): Promise<{ message: string; order: Order }> => {
    return fetchApi<{ message: string; order: Order }>(`/permit/vendor/orders/${id}`, {
      method: 'DELETE',
    });
  },
};


